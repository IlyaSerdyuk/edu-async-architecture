# Черновой проект системы
## Сервисы и их задачи
### Auth
- Аутентификация
- Хранение данных пользователей

### Tasks
- Хранение и просмотр задач
- Добавление задач
- Переназначение задач, включая массовое

### Accounts
- Хранение движения по счетам пользователей
- Дашборд для исполнителей
- Дашборд для топ-менеджмента

### Billing
- Проведение выплат
- Хранение отчетов по выплатам

### Mailer
- Отправка писем о выплате

### Analytics
- Хранение данных в оптимизированном для статистики виде

У каждого сервиса свой фронтенд.

Роутинг между ними осуществляется на сетевом уровне (nginx).

Авторизация устанавливает куки (id и role), которые используют все сервисы.

Возможно, понадобится сервис для поддержки сессий.

## Схемы данных сервисов
У каждого сервиса своя БД.

### Auth
Users: id, email, role

### Tasks
Tasks: id, title, status, user_id

### Accounts
Transactions: id, datetime, user_id, task_id, sum, balance

### Billing
Users: id, card_number (перечисляем по номеру карты), status

### Mailer
Mails: id, email, message, status

### Analytics
Dates: id, date, profit (доход топов), losers (число ушедших в минус), task_top_id

## Взаимодействие сервисов
Сервисы взаимодействуют через брокер сообщений.

Дополнение информации из данных других сервисов осуществляется через REST API, что сокращает дублирование данных. Можно сократить и эту связность, но тогда придётся хранить одни и тоже данные в нескольких местах.

Принцип «А»: управление через брокер сообщение, просмотр через REST API.

### Auth
Пока придерживаемся принципа А, сервис не взаимодействует с другими сервисами.

#### REST API:
- Получить список исполнителей
- Получить имя пользователя (login) по id

### Tasks
#### Исходящие сообщения:
- Задача назначена
- Задача закрыта

#### REST API:
- Получить информацию по задаче по её id

### Accounts
#### Исходящие сообщения:
- Выплата попугаю

#### Входящие сообщения:
- Задача назначена
- Задача закрыта

### Billing
#### Входящие сообщения:
- Выплата попугаю

#### REST API:
- Проверка статуса выплаты

### Mailer
#### Входящие сообщения:
- Выплата попугаю

### Analytics
#### Входящие сообщения:
- Задача назначена
- Задача закрыта

## Инфраструктура
Все сервисы живут в докере и оркестрируются docker compose.

БД: один контейнер с MySQL, разные базы у каждого сервиса.

Брокер сообщений: контейнер с RabbitMQ.

Веб-сервер: nginx
